


### üìò Tabla: `diccionario`

```sql
DROP TABLE diccionario;
CREATE TABLE diccionario (
    palabra TEXT NOT NULL
);

INSERT INTO diccionario (palabra)
VALUES 
    ('buscar'),
    ('buscado'),
    ('buscador'),
    ('buscando'),
    ('busca'),
    ('b√∫squeda'),
    ('busc√≥n'),
    ('buscaba'),
    ('busqu√©'),
    ('busquemos'),
    ('busc√°is'),
    ('busquen'),
    ('busco'),
    ('busqu√©is'),
    ('buscaste'),
    ('buscamos'),
    ('buscaban'),
    ('buscador'),
    ('buscadores'),
    ('buscadora'),
    ('buscadoras');

select * FROM diccionario;
```



# üîç 1. Usar `ILIKE` 

Se usa para coincidencia parcial (b√∫squeda b√°sica)

```sql

-- Obtendran 0 resultados ya que no hay ninguna palabra que dentro de su texto diga buscada
SELECT palabra FROM diccionario WHERE palabra ILIKE '%buscada%';

```

Esto busca cualquier palabra que contenga la cadena `"buscada"` sin importar may√∫sculas/min√∫sculas.




# üß† 2. Usar `SIMILARITY()`
requiere de  la extensi√≥n `pg_trgm` y sirve para (b√∫squeda por similitud)

### üîç ¬øC√≥mo funciona `similarity`?

Internamente, PostgreSQL:
1. **Divide cada texto en trigramas** (grupos de 3 caracteres).
2. **Calcula la intersecci√≥n y la uni√≥n** de los trigramas de ambos textos.
3. **Aplica la f√≥rmula de similitud**:

$$
\text{similarity}(A, B) = \frac{|\text{trigramas comunes}|}{|\text{trigramas totales (uni√≥n)}|}
$$

Este valor retorna un decimal entre **0** (nada en com√∫n) y **1** (id√©nticos).

### ¬øC√≥mo interpretar los resultados?

| Similitud | Interpretaci√≥n |
|-----------|----------------|
| 0.9 - 1.0 | Muy similares o casi iguales |
| 0.7 - 0.9 | Bastante similares |
| 0.4 - 0.7 | Algo similares |
| 0.0 - 0.4 | Poco o nada similares |

### Paso 1: Activar la extensi√≥n
```sql
CREATE EXTENSION IF NOT EXISTS pg_trgm;
```

### Paso 2: Buscar palabras similares
```sql
SELECT palabra, similarity(palabra, 'buscada') AS similitud
FROM diccionario
WHERE palabra % 'buscada'  -- operador de similitud
ORDER BY similitud DESC
LIMIT 5;

+----------+------------+
| palabra  | similitud  |
+----------+------------+
| buscado  |        0.6 |
| busca    |  0.5555556 |
| buscador | 0.54545456 |
| buscador | 0.54545456 |
| buscar   |        0.5 |
+----------+------------+
```

Esto te da las palabras m√°s parecidas a lo que el usuario escribi√≥, ordenadas por similitud.

### Puedes ajustar el umbral m√≠nimo para que el operador % funcione:
```
SET pg_trgm.similarity_threshold = 

postgres@postgres# select name,setting from pg_settings where name ilike '%trgm%';
+------------------------------------------+---------+
|                   name                   | setting |
+------------------------------------------+---------+
| pg_trgm.similarity_threshold             | 0.3     |
| pg_trgm.strict_word_similarity_threshold | 0.5     |
| pg_trgm.word_similarity_threshold        | 0.6     |
+------------------------------------------+---------+
(3 rows)
```




## üß™ 3. Usar `LEVENSHTEIN()` 

## üî¢ ¬øQu√© es la distancia de Levenshtein?

Es una **medida de diferencia** entre dos cadenas de texto. Representa el **n√∫mero m√≠nimo de operaciones necesarias** para transformar una cadena en otra. Las operaciones permitidas son:

1. **Inserci√≥n** de un car√°cter.
2. **Eliminaci√≥n** de un car√°cter.
3. **Sustituci√≥n** de un car√°cter.



### üìä Ejemplo pr√°ctico

Comparando `'gato'` con `'pato'`:

- Cambiar `'g'` por `'p'` ‚Üí 1 sustituci√≥n.

**Distancia de Levenshtein = 1**



### üîÅ Flujo de la funci√≥n

La funci√≥n sigue estos pasos:

1. **Inicializa una matriz** de tama√±o `(longitud de cadena A + 1) x (longitud de cadena B + 1)`.
2. **Llena la primera fila y columna** con valores incrementales (representan inserciones o eliminaciones).
3. **Compara cada car√°cter** de ambas cadenas.
4. **Calcula el costo m√≠nimo** entre:
   - Insertar un car√°cter.
   - Eliminar un car√°cter.
   - Sustituir un car√°cter (si son diferentes).
5. **Llena la matriz** con los valores m√≠nimos en cada paso.
6. **El valor final** en la esquina inferior derecha de la matriz es la distancia de Levenshtein.



### üß† ¬øPara qu√© sirve o Cu√°ndo usar levenshtein?

- **Correcci√≥n ortogr√°fica**: sugerir palabras similares.
- **B√∫squeda difusa o Sugerencias de texto**: encontrar coincidencias aproximadas.
- **Comparaci√≥n de nombres, direcciones, etc.** en bases de datos.


### Paso 1: Activar la extensi√≥n
```sql
CREATE EXTENSION IF NOT EXISTS fuzzystrmatch;
```

### Paso 2: Buscar por distancia de edici√≥n
```sql
SELECT palabra, levenshtein(palabra, 'buscada') AS distancia
FROM diccionario
ORDER BY distancia ASC
LIMIT 5;
```
 
 
La forma **m√°s avanzada y precisa** de hacer b√∫squeda de palabras similares en PostgreSQL ‚Äîideal para una p√°gina web tipo buscador






--- 

# Usar soundex o Metaphone
Estos utiliza la Comparaci√≥n fon√©tica y requiere de la extensi√≥n fuzzystrmatch


## üîä ¬øC√≥mo funciona?

En lugar de comparar letras o trigramas como en la comparaci√≥n l√©xica, la comparaci√≥n fon√©tica convierte las palabras en **c√≥digos fon√©ticos** que representan c√≥mo suenan. Luego compara esos c√≥digos.

 

### üß∞ Algoritmos comunes

1. **Soundex**
   - Convierte palabras en un c√≥digo de 4 caracteres basado en su sonido.
   - Ejemplo: `'Ruiz'` y `'Ruis'` ‚Üí mismo c√≥digo Soundex.
   - Muy usado en bases de datos como SQL Server y tambi√©n disponible en PostgreSQL.

2. **Metaphone / Double Metaphone**
   - M√°s avanzado que Soundex.
   - Considera reglas fon√©ticas del ingl√©s.
   - Puede generar dos c√≥digos por palabra (por ejemplo, para nombres extranjeros).

3. **Cologne Phonetic (K√∂lner Phonetik)**
   - Adaptado para el idioma alem√°n.

 

### üìò Ejemplo en PostgreSQL con `Soundex`

```sql
SELECT palabra
FROM diccionario
WHERE soundex(palabra) = soundex('ruis');
```

Esto devolver√≠a palabras que suenan como `'ruis'`, aunque est√©n escritas diferente.

 

### üß† ¬øCu√°ndo usar comparaci√≥n fon√©tica?

- B√∫squeda de nombres en bases de datos (por ejemplo, `'Jon'`, `'John'`, `'Jhon'`).
- Correcci√≥n de errores de escritura por pronunciaci√≥n.
- Sistemas de b√∫squeda que deben tolerar errores humanos.

 
 
 
La diferencia entre **Metaphone** y **Soundex** radica en la **precisi√≥n fon√©tica**, el **idioma para el que fueron dise√±ados**, y la **forma en que codifican las palabras**. Aqu√≠ te explico cada uno:


## üîç Soundex

### ‚úÖ Caracter√≠sticas:
- **Dise√±ado para ingl√©s**.
- Convierte palabras en un c√≥digo de 4 caracteres:
  - La primera letra se conserva.
  - Las siguientes letras se convierten en n√∫meros seg√∫n grupos fon√©ticos.
  - Se eliminan vocales y letras repetidas.

### üìä Ejemplo:
- `'Ruiz'` ‚Üí `R200`
- `'Ruis'` ‚Üí `R200`  
  ‚Üí **Coinciden**, porque suenan igual.

### ‚ö†Ô∏è Limitaciones:
- Muy b√°sico.
- No distingue bien entre sonidos similares complejos.
- No funciona bien con nombres no ingleses.

 

## üîç Metaphone

### ‚úÖ Caracter√≠sticas:
- **M√°s avanzado que Soundex**.
- Considera reglas fon√©ticas m√°s precisas del ingl√©s.
- Codifica sonidos como `'F'`, `'K'`, `'S'`, `'X'`, etc.
- Elimina letras mudas y agrupa sonidos similares.

### üìä Ejemplo:
- `'Ruiz'` ‚Üí `RS`
- `'Ruis'` ‚Üí `RS`  
  ‚Üí Tambi√©n coinciden, pero con mejor precisi√≥n fon√©tica.

### üß† Ventajas:
- M√°s preciso para nombres y palabras con sonidos complejos.
- Mejora la b√∫squeda fon√©tica en bases de datos.

 

## üÜö Comparaci√≥n directa

| Caracter√≠stica        | Soundex         | Metaphone        |
|-----------------------|------------------|------------------|
| Precisi√≥n fon√©tica    | Baja              | Alta              |
| Longitud del c√≥digo   | Fija (4 caracteres) | Variable         |
| Idioma principal      | Ingl√©s            | Ingl√©s            |
| Manejo de letras mudas| No                | S√≠                |
| Uso en bases de datos | SQL Server, PostgreSQL | PostgreSQL, NLP |


### üîä Soundex
Esto busca palabras que **suenan como** `'buscada'` seg√∫n el algoritmo Soundex.

```sql
SELECT palabra, soundex(palabra) AS soundex_code
FROM diccionario
WHERE soundex(palabra) = soundex('buscada');
```
 
### üß† Metaphone
Esto busca palabras con **c√≥digos fon√©ticos similares** usando Metaphone (hasta 10 caracteres).

```sql
SELECT palabra, metaphone(palabra, 10) AS metaphone_code
FROM diccionario
WHERE metaphone(palabra, 10) = metaphone('buscada', 10);
```

---







--- 

# Extra ejemplo  B√∫squeda avanzada sem√°ntica y fon√©tica 

### 1. **Extensiones necesarias**
Activa estas extensiones en PostgreSQL:

```sql
CREATE EXTENSION IF NOT EXISTS pg_trgm;
CREATE EXTENSION IF NOT EXISTS fuzzystrmatch;
```



### 2. **Crear √≠ndice para acelerar b√∫squedas**
Esto mejora el rendimiento de b√∫squedas por similitud:

```sql
CREATE INDEX idx_palabra_trgm ON diccionario USING gin (palabra gin_trgm_ops);
```

### 3. **Consulta avanzada combinando similitud y fon√©tica**

```sql
SELECT palabra,
       similarity(palabra, 'buscada') AS similitud,
       levenshtein(lower(palabra), lower('buscada')) AS distancia,
       soundex(palabra) = soundex('buscada') AS foneticamente_similar
FROM diccionario
WHERE palabra % 'buscada'  -- operador de similitud
ORDER BY similitud DESC, distancia ASC
LIMIT 5;
```

### ¬øQu√© hace esto?

- `similarity()`: mide qu√© tan parecida es la palabra.
- `levenshtein()`: mide cu√°ntos cambios se necesitan para convertir una palabra en otra.
- `soundex()`: compara c√≥mo suenan las palabras (√∫til para errores de escritura fon√©tica).
- `palabra % 'buscada'`: usa el operador de similitud de `pg_trgm`.


---


## üîç Tabla Comparativa de Herramientas de B√∫squeda de Texto

| Tecnolog√≠a         | ¬øQu√© hace?                          | ¬øCu√°ndo usarla?                     | Precisi√≥n | Velocidad | Ideal para                        |
|-------------------|-------------------------------------|-------------------------------------|-----------|-----------|-----------------------------------|
| `pg_trgm`         | B√∫squeda por similitud de texto     | Correcci√≥n ortogr√°fica, sugerencias | Alta      | Muy alta  | Errores ortogr√°ficos, sugerencias |
| `LIKE` / `ILIKE`  | Coincidencia exacta o parcial       | B√∫squeda simple                     | Media     | Muy alta  | Filtros r√°pidos y directos        |
| `tsvector`        | Indexaci√≥n sem√°ntica                | B√∫squeda contextual                 | Alta      | Alta      | B√∫squeda sem√°ntica contextual     |
| `tsquery`         | Consulta sem√°ntica avanzada         | Filtros por significado             | Alta      | Alta      | B√∫squeda con operadores l√≥gicos   |
| `fuzzystrmatch`   | Comparaci√≥n fon√©tica                | Nombres mal escritos                | Media     | Media     | Comparaci√≥n l√©xica y fon√©tica     |

---

## üß† Glosario de t√©rminos t√©cnicos

### 1. **Similitud**
- **Definici√≥n**: Medida que indica qu√© tan parecidos son dos textos.
- **Ejemplo**: `'buscado'` y `'buscador'` tienen alta similitud porque comparten muchas letras en el mismo orden.
- **En PostgreSQL**: La funci√≥n `similarity(text1, text2)` devuelve un valor entre 0 y 1.

---

### 2. **Distancia**
- **Definici√≥n**: Medida de cu√°n diferentes son dos textos.
- **Tipos comunes**:
  - **Levenshtein**: N√∫mero m√≠nimo de ediciones (inserciones, eliminaciones, sustituciones) para transformar un texto en otro.
  - **Jaccard**: Basada en la intersecci√≥n y uni√≥n de conjuntos de trigramas.
- **Relaci√≥n con similitud**: A mayor distancia, menor similitud.

---

### 3. **Trigrama**
- **Definici√≥n**: Secuencia de tres caracteres consecutivos en un texto.
- **Ejemplo**: Para `'buscada'`, los trigramas son `bus`, `usc`, `sca`, `cad`, `ada`.
- **Uso en `pg_trgm`**: PostgreSQL compara trigramas para calcular similitud.

---

### 4. **Operador `%`**
- **Definici√≥n**: Operador de similitud en PostgreSQL.
- **Funci√≥n**: Filtra registros que son "suficientemente similares" al texto buscado.
- **Ejemplo**: `palabra % 'buscada'` devuelve palabras con similitud mayor al umbral.

---

### 5. **B√∫squeda sem√°ntica**
- **Definici√≥n**: Busca entender el significado del texto, no solo su forma.
- **Ejemplo**: `'auto'` y `'veh√≠culo'` pueden considerarse similares aunque no compartan letras.
- **Nota**: PostgreSQL no hace b√∫squeda sem√°ntica nativa, pero se puede integrar con herramientas como embeddings o modelos NLP.

### La **comparaci√≥n fon√©tica** 
es una t√©cnica que busca determinar si dos palabras **suenan parecido**, 
aunque est√©n escritas de forma diferente. Es muy √∫til en sistemas de b√∫squeda, correcci√≥n ortogr√°fica o bases de datos donde los nombres pueden tener errores de escritura pero conservar una pronunciaci√≥n similar.


---

### 6. **Comparaci√≥n l√©xica**
- **Definici√≥n**: Comparaci√≥n basada en la forma textual (letras, orden, longitud).
- **Ejemplo**: `'casa'` y `'casas'` son l√©xicamente similares.
- **Uso**: Es la base de `pg_trgm`, `LIKE`, `ILIKE`, y operadores de texto.

---

### 7. **Umbral de similitud (`pg_trgm.similarity_threshold`)**
- **Definici√≥n**: Valor m√≠nimo para que el operador `%` considere dos textos como similares.
- **Ejemplo**: Si el umbral es `0.4`, solo se consideran similares los textos con `similarity >= 0.4`.

----



### Bibliograf√≠a
```
https://medium.com/the-table-sql-and-devtalk/mastering-postgresql-full-text-search-a-definitive-guide-a794b47dfcbf
pgvector -> https://github.com/CR0NYM3X/POSTGRESQL/blob/main/Extensiones/pgvector.md
```
